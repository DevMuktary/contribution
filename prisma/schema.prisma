generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(cuid())
  name           String
  email          String          @unique
  password       String
  isAdmin        Boolean         @default(false)
  createdAt      DateTime        @default(now())
  
  virtualAccount VirtualAccount?
  contributions  Contribution[]
}

model VirtualAccount {
  id                    String   @id @default(cuid())
  bankCode              String
  accountNumber         String   @unique
  accountName           String
  bankName              String
  reservationReference  String?
  userId                String   @unique
  user                  User     @relation(fields: [userId], references: [id])
}

model Contribution {
  id                    String   @id @default(cuid())
  amount                Float
  transactionReference  String   @unique
  status                String   @default("SUCCESS")
  createdAt             DateTime @default(now())
  userId                String
  user                  User     @relation(fields: [userId], references: [id])
}

// --- NEW LOGIC START ---
model SavingsGoal {
  id           String   @id @default(cuid())
  title        String   // e.g. "December Wedding 2026"
  cashOutDate  DateTime // The Countdown stops here
  isActive     Boolean  @default(true)
  
  // Relations
  monthlyTargets MonthlyTarget[]
}

model MonthlyTarget {
  id            String      @id @default(cuid())
  month         Int         // 1 = January, 2 = February
  year          Int         // 2026
  targetAmount  Float       // e.g. 50,000 for this specific month
  
  goalId        String
  goal          SavingsGoal @relation(fields: [goalId], references: [id])
  
  @@unique([month, year, goalId]) // Prevent duplicate targets for same month
}
